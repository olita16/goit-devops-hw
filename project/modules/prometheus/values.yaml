server:
  enabled: true

  service:
    type: LoadBalancer
    servicePort: 80
    targetPort: 9090

  persistentVolume:
    enabled: true
    storageClass: "gp2"
    size: 20Gi

  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  retention: "15d"

  global:
    scrape_interval: 15s
    evaluation_interval: 15s
    external_labels:
      cluster: "eks-cluster"
      environment: "production"

alertmanager:
  enabled: true

  service:
    type: LoadBalancer
    servicePort: 80
    targetPort: 9093

  persistentVolume:
    enabled: true
    storageClass: "gp2"
    size: 5Gi

  statefulSet:
    enabled: true

  persistence:
    storageClass: "gp2"
    size: 5Gi

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  config:
    global:
      resolve_timeout: 5m
    route:
      group_by: ["alertname", "cluster", "service"]
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 12h
      receiver: "default"
    receivers:
      - name: "default"

nodeExporter:
  enabled: true

  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 64Mi

  hostNetwork: true
  hostPID: true

pushgateway:
  enabled: true

  service:
    type: ClusterIP
    servicePort: 9091

  persistentVolume:
    enabled: true
    storageClass: "gp2"
    size: 5Gi

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

kubeStateMetrics:
  enabled: true

serverFiles:
  alerting_rules.yml:
    groups:
      - name: kubernetes_alerts
        rules:
          - alert: PodCrashLooping
            expr: rate(kube_pod_container_status_restarts_total[15m]) > 0
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "Pod {{ $labels.namespace }}/{{ $labels.pod }} is crash looping"
              description: "Pod {{ $labels.namespace }}/{{ $labels.pod }} has restarted {{ $value }} times in the last 15 minutes"

          - alert: NodeNotReady
            expr: kube_node_status_condition{condition="Ready",status="true"} == 0
            for: 5m
            labels:
              severity: critical
            annotations:
              summary: "Node {{ $labels.node }} is not ready"
              description: "Node {{ $labels.node }} has been in NotReady state for more than 5 minutes"

          - alert: HighMemoryUsage
            expr: (sum(container_memory_working_set_bytes) BY (pod, namespace) / sum(container_spec_memory_limit_bytes) BY (pod, namespace)) > 0.9
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "High memory usage in pod {{ $labels.namespace }}/{{ $labels.pod }}"
              description: "Pod {{ $labels.namespace }}/{{ $labels.pod }} is using more than 90% of its memory limit"

          - alert: HighCPUUsage
            expr: sum(rate(container_cpu_usage_seconds_total[5m])) BY (pod, namespace) / sum(container_spec_cpu_quota/container_spec_cpu_period) BY (pod, namespace) > 0.9
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "High CPU usage in pod {{ $labels.namespace }}/{{ $labels.pod }}"
              description: "Pod {{ $labels.namespace }}/{{ $labels.pod }} is using more than 90% of its CPU limit"